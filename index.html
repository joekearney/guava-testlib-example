<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>guava-testlib-example by joekearney</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/joekearney/guava-testlib-example">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/joekearney/guava-testlib-example/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/joekearney/guava-testlib-example/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>guava-testlib-example</h1>
          <p>An example of how to write test suites with Guava Testlib</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/joekearney">joekearney</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <p>Guava Testlib was written to test collections implementations exhaustively. It's general enough to allow tests to be written for any interface and have them run against many different implementations. It generates the cross product (filtered according to features) of tests and implementations and puts them in a nice hierarchy that looks great in Eclipse.</p>

<p>Tests can be annotated with <code>Feature</code>s that correspond to differences in implementations of the interface specification – the same set of tests can be used to test mutable and immutable collections, for example, and the framework will decide which tests to add to which suite.</p>

<p>This project shows a simple and contrived example of how to set up these tests. We have a <code>Calculator</code> interface and various implementations that support some of the operations for some of the parameters.</p>

<hr><h1>
<a name="what-are-the-components" class="anchor" href="#what-are-the-components"><span class="octicon octicon-link"></span></a>What are the components?</h1>

<ul>
<li>
<code>FeatureSpecificTestSuiteBuilder</code> – this creates the test suite. Extend this, pass it a subject generator and call <code>createTestSuite</code>. This is where the set of tester classes is declared.</li>
<li>
<code>TestSubjectGenerator</code> &amp;ndaash; this is just a supplier of your implementation.</li>
<li>
<code>AbstractTester</code> – extend this to provide actual tests. Test methods should be JUnit 3 style tests, not using <code>@Test</code> annotations. This class provides access to the subject generator. You might also want an abstract subclass fro m which your test cases extend if you want to give default assertion methods, for example.</li>
</ul><h1>
<a name="lets-get-started" class="anchor" href="#lets-get-started"><span class="octicon octicon-link"></span></a>Let's get started</h1>

<p>We'll start with a really simple calculator interface. We can consider an implementation that uses <code>BigDecimal</code> to make accurate calculations, and a strict integer calculator that doesn't know about decimals and throws if passed anything other than an <code>Integer</code>.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Calculator</span> <span class="o">{</span>
    <span class="k">default</span> <span class="n">Number</span> <span class="nf">add</span><span class="o">(</span><span class="n">Number</span> <span class="n">a</span><span class="o">,</span> <span class="n">Number</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">();</span> <span class="o">}</span>
    <span class="k">default</span> <span class="n">Number</span> <span class="nf">multiply</span><span class="o">(</span><span class="n">Number</span> <span class="n">a</span><span class="o">,</span> <span class="n">Number</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Tag <a href="https://github.com/joekearney/guava-testlib-example/tree/01-basic-code"><code>01-basic-code</code></a> provides first basic implementations of our <code>Calculator</code> API. Tag <a href="https://github.com/joekearney/guava-testlib-example/tree/02-basic-testlib"><code>02-basic-testlib</code></a> adds the basics of the test framework. In particular, the test suite builder:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculatorTestSuiteBuilder</span> <span class="kd">extends</span>
      <span class="n">FeatureSpecificTestSuiteBuilder</span><span class="o">&lt;</span><span class="n">CalculatorTestSuiteBuilder</span><span class="o">,</span> <span class="n">CalculatorTestSubjectGenerator</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">AbstractTester</span><span class="o">&gt;&gt;</span> <span class="n">getTesters</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ImmutableList</span><span class="o">.&lt;</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">AbstractTester</span><span class="o">&gt;&gt;</span><span class="n">of</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">CalculatorTestSuiteBuilder</span> <span class="nf">using</span><span class="o">(</span><span class="n">CalculatorTestSubjectGenerator</span> <span class="n">generator</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CalculatorTestSuiteBuilder</span><span class="o">().</span><span class="na">usingGenerator</span><span class="o">(</span><span class="n">generator</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>As soon as we write any test classes we'll add those classes to the list returned from <code>getTesters</code>.</p>

<h1>
<a name="writing-a-first-test" class="anchor" href="#writing-a-first-test"><span class="octicon octicon-link"></span></a>Writing a first test</h1>

<p>To start with, let's write a superclass for our test cases, which can contain the common assertions and functions that we'll want to use.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculatorTester</span> <span class="kd">extends</span> <span class="n">AbstractTester</span><span class="o">&lt;</span><span class="n">CalculatorTestSubjectGenerator</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assertEqualsExact</span><span class="o">(</span><span class="n">Number</span> <span class="n">actual</span><span class="o">,</span> <span class="kt">long</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="s">"Expected ["</span> <span class="o">+</span> <span class="n">expected</span> <span class="o">+</span> <span class="s">"] but got ["</span> <span class="o">+</span> <span class="n">actual</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">,</span>
            <span class="n">toBigDecimal</span><span class="o">(</span><span class="n">actual</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="n">expected</span><span class="o">))</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/** Converts some useful classes of {@link Number} to {@link BigDecimal}. */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">BigDecimal</span> <span class="nf">toBigDecimal</span><span class="o">(</span><span class="n">Number</span> <span class="n">actual</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>We'll divide the test cases by the separate features of the Calculator that we're testing.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddTester</span> <span class="kd">extends</span> <span class="n">CalculatorTester</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddZero</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Number</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getSubjectGenerator</span><span class="o">().</span><span class="na">createTestSubject</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">assertEqualsExact</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>